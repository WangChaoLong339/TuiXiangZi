{"version":3,"sources":["MapEditor.js"],"names":["cc","Class","extends","Component","properties","top","Node","selectTypeRoot","bottom","map","onLoad","model","select","lineCount","columnCount","mapData","maxMapWidth","ViewSize","width","maxMapHeight","height","item","PathChild","removeAllChildren","selected","onenter","x","children","stopAllActions","runAction","repeatForever","sequence","fadeOut","fadeIn","delayTime","clear","EditBox","string","updateMap","forEach","it","idx","SetSpriteFrame","getPathByType","Sprite","type","error","trySaveMap","callback","boxCount","GetCountFramArray","endCount","UiMgr","showTips","title","msg","btn","name","func","hideTips","btnItemType","event","data","parseInt","btnMapItem","target","btnComfirm","itemSize","i","push","instantiate","parent","btnGenerate","localData","GetLocalStorage","length","SetLocalStorage","btnClose","close","node"],"mappings":"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","file":"MapEditor.js","sourceRoot":"../../../../../../assets/resources/scripts/Ui","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        top: cc.Node,\n        selectTypeRoot: cc.Node,\n        bottom: cc.Node,\n        map: cc.Node,\n    },\n\n    onLoad: function () {\n        this.model = {\n            select: 0, // 0:黑 1:墙 2:箱 3:终 4:合 5:人\n            lineCount: 0,\n            columnCount: 0,\n            mapData: [],\n            maxMapWidth: ViewSize.width,\n            maxMapHeight: ViewSize.height,\n        }\n        this.item = this.map.PathChild('item')\n        this.map.removeAllChildren()\n        this.selected = this.selectTypeRoot.PathChild('selected')\n    },\n\n    onenter: function () {\n        this.selected.x = this.selectTypeRoot.children[1].x\n        this.selected.stopAllActions()\n        this.selected.runAction(cc.repeatForever(cc.sequence(\n            cc.fadeOut(0.5),\n            cc.fadeIn(0.5),\n            cc.delayTime(0.2),\n        )))\n    },\n\n    clear: function () {\n        this.model = {\n            select: 0,\n            lineCount: 0,\n            columnCount: 0,\n            mapData: [],\n        }\n        this.map.children.removeAllChildren()\n        this.bottom.PathChild('lineEditBox', cc.EditBox).string = ''\n        this.bottom.PathChild('columnEditBox', cc.EditBox).string = ''\n        this.updateMap()\n    },\n\n    updateMap: function () {\n        this.map.children.forEach((it, idx) => {\n            SetSpriteFrame(this.getPathByType(this.model.mapData[idx]), it.PathChild('fg', cc.Sprite))\n        })\n    },\n\n    getPathByType: function (type) {\n        switch (type) {\n            case 0:\n                return 'picture/pure/color_dark'\n            case 1:\n                return 'picture/wall/wall_00'\n            case 2:\n                return 'picture/box/box_00'\n            case 3:\n                return 'picture/dot/dot_1'\n            case 4:\n                return 'picture/box/box_01'\n            case 5:\n                return 'picture/hero/down_00'\n            default:\n                cc.error('!--无法匹配的类型--!')\n        }\n    },\n\n    trySaveMap: function (callback) {\n        // 请检查箱子数量和目标点数量是否一致?\n        let boxCount = GetCountFramArray(this.model.mapData, 2)\n        let endCount = GetCountFramArray(this.model.mapData, 3)\n        if (boxCount != endCount) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '请检查箱子数量和目标点数量是否一致?',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        // 至少需要一个箱子和目标点!\n        if (boxCount <= 0 || endCount <= 0) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '至少需要一个箱子和目标点!',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        // 人物有且只能有一个!\n        if (GetCountFramArray(this.model.mapData, 5) != 1) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '人物有且只能有一个!',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n\n        callback()\n        UiMgr.showTips({\n            title: '提示',\n            msg: '保存地图成功',\n            btn: [{ name: '确认', func: UiMgr.hideTips },],\n        })\n    },\n\n    btnItemType: function (event, data) {\n        this.selected.x = this.selectTypeRoot.children[parseInt(data) + 1].x\n        this.model.select = parseInt(data)\n    },\n\n    btnMapItem: function (event) {\n        let idx = event.target.idx\n        this.model.mapData[idx] = this.model.select\n        this.updateMap()\n    },\n\n    btnComfirm: function () {\n        this.model.lineCount = parseInt(this.bottom.PathChild('lineEditBox', cc.EditBox).string) || 0\n        this.model.columnCount = parseInt(this.bottom.PathChild('columnEditBox', cc.EditBox).string) || 0\n        if (this.model.lineCount < 3 || this.model.lineCount > 15 || !this.model.columnCount || this.model.columnCount < 3 || this.model.columnCount > 15) {\n            UiMgr.showTips({\n                title: '输入错误提示',\n                msg: '输入的地图尺寸错误',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        let itemSize = null\n        // 横图 || 方形图\n        if (this.model.lineCount >= this.model.columnCount) {\n            itemSize = parseInt(this.model.maxMapWidth / this.model.lineCount)\n            this.map.width = this.model.maxMapWidth\n        }\n        // 竖图\n        if (this.model.lineCount < this.model.columnCount) {\n            itemSize = parseInt(this.model.maxMapWidth / this.model.columnCount)\n            this.map.width = this.model.lineCount * itemSize\n        }\n\n        this.map.removeAllChildren()\n        this.model.mapData = []\n        for (var i = 0; i < this.model.lineCount * this.model.columnCount; i++) {\n            this.model.mapData.push(0)\n            let item = cc.instantiate(this.item)\n            item.idx = i\n            item.width = itemSize\n            item.height = itemSize\n            item.parent = this.map\n        }\n        this.updateMap()\n    },\n\n    btnGenerate: function () {\n        this.trySaveMap(() => {\n            let localData = GetLocalStorage('TuiXiangZi-info') || []\n            let i = localData.length > 0 ? localData[localData.length - 1].idx + 1 : 0\n            localData.push({ idx: i, lineCount: this.model.lineCount, columnCount: this.model.columnCount, map: this.model.mapData })\n            SetLocalStorage('TuiXiangZi-info', localData)\n            this.clear()\n        })\n    },\n\n    btnClose: function () {\n        UiMgr.close(this.node.name)\n    },\n});\n"]}