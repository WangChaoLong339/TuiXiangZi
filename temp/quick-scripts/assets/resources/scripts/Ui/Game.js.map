{"version":3,"sources":["Game.js"],"names":["cc","Class","extends","Component","properties","title","Label","map","Node","item","player","onLoad","maxWidth","width","active","onenter","info","initData","setupTop","createMap","updateMap","moving","mapInfo","point","current","x","y","i","length","lineCount","parseInt","string","idx","itemSize","removeAllChildren","instantiate","height","parent","children","PathChild","setSpriteFrame","tryMoveTo","arrive","distance","moveBy","arr","runAction","sequence","v2","callFunc","btnMove","event","data","btnClose","UiMgr","close","node","name"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../../../assets/resources/scripts/Ui","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        title: cc.Label,\n        map: cc.Node,\n        item: cc.Node,\n        player: cc.Node,\n    },\n\n    onLoad: function () {\n        this.maxWidth = this.map.width\n        this.item.active = false\n    },\n\n    onenter: function (info) {\n        this.initData(info)\n        this.setupTop()\n        this.createMap()\n        this.updateMap()\n    },\n\n    initData: function (info) {\n        this.moving = false\n        this.mapInfo = info\n        this.point = 0 // 0:down 1:right 2:up 3:left\n\n        this.current = { x: null, y: null }\n        for (let i = 0; i < this.mapInfo.map.length; i++) {\n            if (this.mapInfo.map[i] == 5) {\n                this.current = { x: i % this.mapInfo.lineCount, y: parseInt(i / this.mapInfo.lineCount) }\n                break\n            }\n        }\n    },\n\n    setupTop: function () {\n        this.title.string = `第${this.mapInfo.idx + 1}关`\n    },\n\n    createMap: function () {\n        let lineCount = this.mapInfo.lineCount\n        let itemSize = parseInt(this.maxWidth / lineCount)\n        this.map.removeAllChildren()\n        for (let i = 0; i < this.mapInfo.map.length; i++) {\n            let item = cc.instantiate(this.item)\n            item.width = itemSize\n            item.height = itemSize\n            item.active = true\n            item.parent = this.map\n        }\n    },\n\n    updateMap: function () {\n        for (let i = 0; i < this.map.children.length; i++) {\n            let item = this.map.children[i]\n            item.PathChild('val').x = 0\n            item.PathChild('val').y = 0\n            item.PathChild('val', 'MultiFrame').setSpriteFrame(this.mapInfo.map[i])\n        }\n    },\n\n    tryMoveTo: function (point) {\n        let arrive = null\n        let distance = parseInt(this.maxWidth / this.mapInfo.lineCount)\n        let moveBy = { x: 0, y: 0 }\n        switch (point) {\n            case 0:// up\n                arrive = { x: this.current.x, y: this.current.y - 1 }\n                moveBy = { x: 0, y: distance }\n                break\n            case 1:// left\n                arrive = { x: this.current.x - 1, y: this.current.y }\n                moveBy = { x: -distance, y: 0 }\n                break\n            case 2:// down\n                arrive = { x: this.current.x, y: this.current.y + 1 }\n                moveBy = { x: 0, y: -distance }\n                break\n            case 3:// right\n                arrive = { x: this.current.x + 1, y: this.current.y }\n                moveBy = { x: distance, y: 0 }\n                break\n        }\n        let arr = this.mapInfo.map[arrive.x + arrive.y * this.mapInfo.lineCount]\n        // 目标点是 [空白] 或者 [终点]\n        if (arr == 0 || arr == 3) {\n            // 人物移动\n            this.moving = true\n            this.map.children[this.current.x + this.current.y * this.mapInfo.lineCount].PathChild('val').runAction(cc.sequence(\n                cc.moveBy(0.3, cc.v2(moveBy.x, moveBy.y)),\n                cc.callFunc(() => {\n                    this.moving = false\n                    switch (point) {\n                        case 0:// up\n                            break\n                        case 1:// left\n                            break\n                        case 2:// down\n                            break\n                        case 3:// right\n                            break\n                    }\n                }),\n            ))\n        }\n        // // 目标点是 [箱子]\n        // if (arr == 2) {\n        //     // 箱子移动\n        //     this.map.children[arrive.x + arrive.y * this.mapInfo.lineCount].PathChild('val').runAction(cc.sequence(\n        //         cc.moveBy(0.3, moveBy),\n        //         cc.callFunc(() => { }),\n        //     ))\n        // }\n    },\n\n    btnMove: function (event, data) {\n        if (this.moving) {\n            return\n        }\n        this.tryMoveTo(parseInt(data))\n    },\n\n    btnClose: function () {\n        UiMgr.close(this.node.name)\n    },\n});\n"]}