{"version":3,"sources":["../../../../../../assets/resources/scripts/Ui/assets/resources/scripts/Ui/Game.js"],"names":["cc","Class","extends","Component","properties","title","Label","map","Node","item","onLoad","maxWidth","width","active","onenter","info","initData","setupTop","createMap","updateMap","moving","mapInfo","current","x","y","i","length","lineCount","parseInt","string","idx","itemSize","removeAllChildren","instantiate","height","parent","children","PathChild","setSpriteFrame","tryMoveTo","point","arrive","distance","moveBy","arr","runAction","v2","btnMove","event","data","btnClose","UiMgr","close","node","name"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../../../assets/resources/scripts/Ui","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        title: cc.Label,\n        map: cc.Node,\n        item: cc.Node,\n    },\n\n    onLoad: function () {\n        this.maxWidth = this.map.width\n        this.item.active = false\n    },\n\n    onenter: function (info) {\n        this.initData(info)\n        this.setupTop()\n        this.createMap()\n        this.updateMap()\n    },\n\n    initData: function (info) {\n        this.moving = false\n        this.mapInfo = info\n\n        this.current = { x: null, y: null }\n        for (let i = 0; i < this.mapInfo.map.length; i++) {\n            if (this.mapInfo.map[i] == 5) {\n                this.current = { x: i % this.mapInfo.lineCount, y: parseInt(i / this.mapInfo.lineCount) }\n                break\n            }\n        }\n    },\n\n    setupTop: function () {\n        this.title.string = `第${this.mapInfo.idx + 1}关`\n    },\n\n    createMap: function () {\n        let lineCount = this.mapInfo.lineCount\n        let itemSize = parseInt(this.maxWidth / lineCount)\n        this.map.removeAllChildren()\n        for (let i = 0; i < this.mapInfo.map.length; i++) {\n            let item = cc.instantiate(this.item)\n            item.width = itemSize\n            item.height = itemSize\n            item.active = true\n            item.parent = this.map\n        }\n    },\n\n    updateMap: function () {\n        for (let i = 0; i < this.map.children.length; i++) {\n            let item = this.map.children[i]\n            item.PathChild('val').x = 0\n            item.PathChild('val').y = 0\n            item.PathChild('val', 'MultiFrame').setSpriteFrame(this.mapInfo.map[i])\n        }\n    },\n\n    tryMoveTo: function (point) {\n        let arrive = null\n        let distance = parseInt(this.maxWidth / this.mapInfo.lineCount)\n        let moveBy = { x: 0, y: 0 }\n        switch (point) {\n            case 0:// up\n                arrive = { x: this.current.x, y: this.current.y - 1 }\n                moveBy = { x: 0, y: distance }\n                break\n            case 1:// left\n                arrive = { x: this.current.x - 1, y: this.current.y }\n                moveBy = { x: -distance, y: 0 }\n                break\n            case 2:// down\n                arrive = { x: this.current.x, y: this.current.y + 1 }\n                moveBy = { x: 0, y: -distance }\n                break\n            case 3:// right\n                arrive = { x: this.current.x + 1, y: this.current.y }\n                moveBy = { x: distance, y: 0 }\n                break\n        }\n        let arr = this.mapInfo.map[arrive.x + arrive.y * this.mapInfo.lineCount]\n        // 目标点是 [空白] 或者 [终点]\n        if (arr == 0 || arr == 3) {\n            // 人物移动\n            this.map.children[this.current.x + this.current.y * this.mapInfo.lineCount].PathChild('val').runAction(cc.moveBy(0.3, cc.v2(moveBy.x, moveBy.y)))\n        }\n        // // 目标点是 [箱子]\n        // if (arr == 2) {\n        //     // 箱子移动\n        //     this.map.children[arrive.x + arrive.y * this.mapInfo.lineCount].PathChild('val').runAction(cc.sequence(\n        //         cc.moveBy(0.3, moveBy),\n        //         cc.callFunc(() => { }),\n        //     ))\n        // }\n    },\n\n    btnMove: function (event, data) {\n        if (this.moving) {\n            return\n        }\n        this.tryMoveTo(parseInt(data))\n    },\n\n    btnClose: function () {\n        UiMgr.close(this.node.name)\n    },\n});\n"]}