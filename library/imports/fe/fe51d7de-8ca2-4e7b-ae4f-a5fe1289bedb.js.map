{"version":3,"sources":["../../../../../../assets/resources/scripts/Ui/assets/resources/scripts/Ui/MapEditor.js"],"names":["cc","Class","extends","Component","properties","mapRoot","Node","mapItem","typeRoot","twinkle","typeItem","bottom","onLoad","model","types","typeIdx","lineCount","columnCount","mapData","maxMapWidth","ViewSize","width","maxMapHeight","height","onenter","initData","removeAllChildren","createTypeItem","typeItemSize","x","children","playTwinkleAction","PathChild","EditBox","string","size","parseInt","length","i","cloneItem","instantiate","SetSpriteFrame","GetPathByType","Sprite","idx","parent","stopAllActions","runAction","repeatForever","sequence","fadeOut","fadeIn","delayTime","createMapItem","itemSize","push","item","updateMap","forEach","it","trySaveMap","callback","boxCount","GetCountFramArray","endCount","UiMgr","showTips","title","msg","btn","name","func","hideTips","btnItemType","event","target","btnMapItem","btnComfirmMapSize","btnGenerate","localData","GetLocalStorage","map","SetLocalStorage","btnClose","close","node"],"mappings":"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","file":"MapEditor.js","sourceRoot":"../../../../../../assets/resources/scripts/Ui","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mapRoot: cc.Node,\n        mapItem: cc.Node,\n\n        typeRoot: cc.Node,\n        twinkle: cc.Node,\n        typeItem: cc.Node,\n\n        bottom: cc.Node,\n    },\n\n    onLoad: function () {\n        this.model = {\n            types: [\n                0, // 空地\n                1, // 墙壁\n                2, // 箱子\n                3, // 目标\n                4, // 箱子 + 目标\n                5, // 人物\n                6, // 人物 + 目标\n            ],\n            typeIdx: 0,\n            lineCount: 0,\n            columnCount: 0,\n            mapData: [],\n            maxMapWidth: ViewSize.width,\n            maxMapHeight: ViewSize.height,\n        }\n    },\n\n    onenter: function () {\n        this.initData()\n\n        // 清空map\n        this.mapRoot.removeAllChildren()\n        // 创建选择节点\n        this.createTypeItem()\n        // 设置选中框\n        this.twinkle.width = this.twinkle.height = this.model.typeItemSize\n        this.twinkle.x = this.typeRoot.children[0].x\n        this.playTwinkleAction()\n        // 清空输入框\n        this.bottom.PathChild('lineEditBox', cc.EditBox).string = ''\n        this.bottom.PathChild('columnEditBox', cc.EditBox).string = ''\n    },\n\n    initData: function () {\n        this.model.typeIdx = 0\n        this.model.lineCount = 0\n        this.model.columnCount = 0\n        this.model.mapData = []\n    },\n\n    createTypeItem: function () {\n        let size = parseInt(this.mapRoot.width / this.model.types.length)\n        this.model.typeItemSize = size > 100 ? 100 : size\n\n        this.typeRoot.removeAllChildren()\n        for (let i = 0; i < this.model.types.length; i++) {\n            let cloneItem = cc.instantiate(this.typeItem)\n            SetSpriteFrame(`${GetPathByType(this.model.types[i])}`, cloneItem.PathChild('val', cc.Sprite))\n            cloneItem.width = this.model.typeItemSize\n            cloneItem.height = this.model.typeItemSize\n            cloneItem.idx = i\n            cloneItem.x = -parseInt(this.model.types.length / 2) * cloneItem.width + i * cloneItem.width\n            cloneItem.parent = this.typeRoot\n        }\n    },\n\n    playTwinkleAction: function () {\n        this.twinkle.stopAllActions()\n        this.twinkle.runAction(cc.repeatForever(cc.sequence(\n            cc.fadeOut(0.5),\n            cc.fadeIn(0.5),\n            cc.delayTime(0.2),\n        )))\n    },\n\n    createMapItem: function () {\n        let itemSize = null\n        // 横图 || 方形图\n        if (this.model.lineCount >= this.model.columnCount) {\n            itemSize = parseInt(this.model.maxMapWidth / this.model.lineCount)\n            this.mapRoot.width = this.model.maxMapWidth\n        }\n        // 竖图\n        if (this.model.lineCount < this.model.columnCount) {\n            itemSize = parseInt(this.model.maxMapWidth / this.model.columnCount)\n            this.mapRoot.width = this.model.lineCount * itemSize\n        }\n\n        this.mapRoot.removeAllChildren()\n        this.model.mapData = []\n        for (let i = 0; i < this.model.lineCount * this.model.columnCount; i++) {\n            this.model.mapData.push(0)\n            let item = cc.instantiate(this.mapItem)\n            item.idx = i\n            item.width = itemSize\n            item.height = itemSize\n            item.parent = this.mapRoot\n        }\n    },\n\n    updateMap: function () {\n        this.mapRoot.children.forEach((it, idx) => {\n            SetSpriteFrame(GetPathByType(this.model.mapData[idx]), it.PathChild('fg', cc.Sprite))\n        })\n    },\n\n    trySaveMap: function (callback) {\n        // 请检查箱子数量和目标点数量是否一致?\n        let boxCount = GetCountFramArray(this.model.mapData, 2)\n        let endCount = GetCountFramArray(this.model.mapData, 3)\n        if (boxCount != endCount) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '请检查箱子数量和目标点数量是否一致?',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        // 至少需要一个箱子和目标点!\n        if (boxCount <= 0 || endCount <= 0) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '至少需要一个箱子和目标点!',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        // 人物有且只能有一个!\n        if (GetCountFramArray(this.model.mapData, 5) != 1) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '人物有且只能有一个!',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n\n        callback()\n        UiMgr.showTips({\n            title: '提示',\n            msg: '保存地图成功',\n            btn: [{ name: '确认', func: UiMgr.hideTips },],\n        })\n    },\n\n    btnItemType: function (event) {\n        this.model.typeIdx = event.target.idx\n        this.twinkle.x = this.typeRoot.children[this.model.typeIdx].x\n    },\n\n    btnMapItem: function (event) {\n        let idx = event.target.idx\n        this.model.mapData[idx] = this.model.typeIdx\n        this.updateMap()\n    },\n\n    btnComfirmMapSize: function () {\n        this.model.lineCount = parseInt(this.bottom.PathChild('lineEditBox', cc.EditBox).string) || 0\n        this.model.columnCount = parseInt(this.bottom.PathChild('columnEditBox', cc.EditBox).string) || 0\n        if (this.model.lineCount < 3 || this.model.lineCount > 15 || !this.model.columnCount || this.model.columnCount < 3 || this.model.columnCount > 15) {\n            UiMgr.showTips({\n                title: '输入错误提示',\n                msg: '输入的地图尺寸错误',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n\n        this.createMapItem()\n    },\n\n    btnGenerate: function () {\n        this.trySaveMap(() => {\n            let localData = GetLocalStorage('TuiXiangZi-info') || []\n            let i = localData.length > 0 ? localData[localData.length - 1].idx + 1 : 0\n            localData.push({ idx: i, lineCount: this.model.lineCount, columnCount: this.model.columnCount, map: this.model.mapData })\n            SetLocalStorage('TuiXiangZi-info', localData)\n            // 重置界面\n            this.onenter()\n        })\n    },\n\n    btnClose: function () {\n        UiMgr.close(this.node.name)\n    },\n});\n"]}