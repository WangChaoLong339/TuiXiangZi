{"version":3,"sources":["../../../../../../assets/resources/scripts/Ui/assets/resources/scripts/Ui/MapEditor.js"],"names":["cc","Class","extends","Component","properties","top","Node","mapRoot","mapItem","typeRoot","twinkle","typeItem","bottom","onLoad","model","types","typeIdx","lineCount","columnCount","mapData","maxMapWidth","ViewSize","width","maxMapHeight","height","typeItemSize","parseInt","length","createTypeItem","removeAllChildren","i","cloneItem","instantiate","SetSpriteFrame","getPathByType","PathChild","Sprite","x","parent","onenter","clear","children","playTwinkleAction","createMapItem","stopAllActions","runAction","repeatForever","sequence","fadeOut","fadeIn","delayTime","EditBox","string","updateMap","forEach","it","idx","type","error","trySaveMap","callback","boxCount","GetCountFramArray","endCount","UiMgr","showTips","title","msg","btn","name","func","hideTips","btnItemType","event","data","btnMapItem","target","btnComfirm","itemSize","push","item","btnGenerate","localData","GetLocalStorage","map","SetLocalStorage","btnClose","close","node"],"mappings":"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","file":"MapEditor.js","sourceRoot":"../../../../../../assets/resources/scripts/Ui","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        top: cc.Node,\n\n        mapRoot: cc.Node,\n        mapItem: cc.Node,\n\n        typeRoot: cc.Node,\n        twinkle: cc.Node,\n        typeItem: cc.Node,\n\n        bottom: cc.Node,\n    },\n\n    onLoad: function () {\n        this.model = {\n            types: [\n                0, // 空地\n                1, // 墙壁\n                2, // 箱子\n                3, // 目标\n                4, // 箱子 + 目标\n                5, // 人物\n                6, // 人物 + 目标\n            ],\n            typeIdx: 0,\n            lineCount: 0,\n            columnCount: 0,\n            mapData: [],\n            maxMapWidth: ViewSize.width,\n            maxMapHeight: ViewSize.height,\n        }\n\n        this.model.typeItemSize = parseInt(this.mapRoot.width / this.model.types.length)\n        this.model.typeItemSize = this.model.typeItemSize > 100 ? 100 : this.model.typeItemSize\n        this.twinkle.width = this.twinkle.height = this.model.typeItemSize\n\n        this.createTypeItem()\n    },\n\n    createTypeItem: function () {\n        this.typeRoot.removeAllChildren()\n        for (let i = 0; i < this.model.types.length; i++) {\n            let cloneItem = cc.instantiate(this.typeItem)\n            SetSpriteFrame(`${this.getPathByType(this.model.types[i])}`, cloneItem.PathChild('val', cc.Sprite))\n            cloneItem.width = this.model.typeItemSize\n            cloneItem.height = this.model.typeItemSize\n            cloneItem.x = -parseInt(this.model.types.length / 2) * cloneItem.width + i * cloneItem.width\n            cloneItem.parent = this.typeRoot\n        }\n    },\n\n    onenter: function () {\n        this.clear()\n        this.twinkle.x = this.typeRoot.children[0].x\n        this.playTwinkleAction()\n    },\n\n    createMapItem: function () {\n        this.mapRoot.removeAllChildren()\n        for (let i = 0; i < this.model.types; i++) {\n        }\n    },\n\n    playTwinkleAction: function () {\n        this.twinkle.stopAllActions()\n        this.twinkle.runAction(cc.repeatForever(cc.sequence(\n            cc.fadeOut(0.5),\n            cc.fadeIn(0.5),\n            cc.delayTime(0.2),\n        )))\n    },\n\n    clear: function () {\n        // 数据层\n        this.model.typeIdx = 0\n        this.model.lineCount = 0\n        this.model.columnCount = 0\n        this.model.mapData = []\n\n        // 界面层\n        this.mapRoot.removeAllChildren()\n        this.bottom.PathChild('lineEditBox', cc.EditBox).string = ''\n        this.bottom.PathChild('columnEditBox', cc.EditBox).string = ''\n    },\n\n    updateMap: function () {\n        this.mapRoot.children.forEach((it, idx) => {\n            SetSpriteFrame(this.getPathByType(this.model.mapData[idx]), it.PathChild('fg', cc.Sprite))\n        })\n    },\n\n    getPathByType: function (type) {\n        switch (type) {\n            case 0:\n                return 'picture/pure/color_dark'\n            case 1:\n                return 'picture/wall/wall_00'\n            case 2:\n                return 'picture/box/box_00'\n            case 3:\n                return 'picture/dot/dot_1'\n            case 4:\n                return 'picture/box/box_01'\n            case 5:\n                return 'picture/hero/down_00'\n            case 6:\n                return 'picture/dot/dot_3'\n            default:\n                cc.error('!--无法匹配的类型--!')\n        }\n    },\n\n    trySaveMap: function (callback) {\n        // 请检查箱子数量和目标点数量是否一致?\n        let boxCount = GetCountFramArray(this.model.mapData, 2)\n        let endCount = GetCountFramArray(this.model.mapData, 3)\n        if (boxCount != endCount) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '请检查箱子数量和目标点数量是否一致?',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        // 至少需要一个箱子和目标点!\n        if (boxCount <= 0 || endCount <= 0) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '至少需要一个箱子和目标点!',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        // 人物有且只能有一个!\n        if (GetCountFramArray(this.model.mapData, 5) != 1) {\n            UiMgr.showTips({\n                title: '警告',\n                msg: '人物有且只能有一个!',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n\n        callback()\n        UiMgr.showTips({\n            title: '提示',\n            msg: '保存地图成功',\n            btn: [{ name: '确认', func: UiMgr.hideTips },],\n        })\n    },\n\n    btnItemType: function (event, data) {\n        this.twinkle.x = this.typeRoot.children[parseInt(data) + 1].x\n        this.model.typeIdx = parseInt(data)\n    },\n\n    btnMapItem: function (event) {\n        let idx = event.target.idx\n        this.model.mapData[idx] = this.model.typeIdx\n        this.updateMap()\n    },\n\n    btnComfirm: function () {\n        this.model.lineCount = parseInt(this.bottom.PathChild('lineEditBox', cc.EditBox).string) || 0\n        this.model.columnCount = parseInt(this.bottom.PathChild('columnEditBox', cc.EditBox).string) || 0\n        if (this.model.lineCount < 3 || this.model.lineCount > 15 || !this.model.columnCount || this.model.columnCount < 3 || this.model.columnCount > 15) {\n            UiMgr.showTips({\n                title: '输入错误提示',\n                msg: '输入的地图尺寸错误',\n                btn: [{ name: '确认', func: UiMgr.hideTips },],\n            })\n            return\n        }\n        let itemSize = null\n        // 横图 || 方形图\n        if (this.model.lineCount >= this.model.columnCount) {\n            itemSize = parseInt(this.model.maxMapWidth / this.model.lineCount)\n            this.mapRoot.width = this.model.maxMapWidth\n        }\n        // 竖图\n        if (this.model.lineCount < this.model.columnCount) {\n            itemSize = parseInt(this.model.maxMapWidth / this.model.columnCount)\n            this.mapRoot.width = this.model.lineCount * itemSize\n        }\n\n        this.mapRoot.removeAllChildren()\n        this.model.mapData = []\n        for (let i = 0; i < this.model.lineCount * this.model.columnCount; i++) {\n            this.model.mapData.push(0)\n            let item = cc.instantiate(this.mapItem)\n            item.idx = i\n            item.width = itemSize\n            item.height = itemSize\n            item.parent = this.mapRoot\n        }\n        this.updateMap()\n    },\n\n    btnGenerate: function () {\n        this.trySaveMap(() => {\n            let localData = GetLocalStorage('TuiXiangZi-info') || []\n            let i = localData.length > 0 ? localData[localData.length - 1].idx + 1 : 0\n            localData.push({ idx: i, lineCount: this.model.lineCount, columnCount: this.model.columnCount, map: this.model.mapData })\n            SetLocalStorage('TuiXiangZi-info', localData)\n            this.clear()\n        })\n    },\n\n    btnClose: function () {\n        UiMgr.close(this.node.name)\n    },\n});\n"]}